# Быстрый старт

Мы собрали для вас готовые образы и залили их в Docker Hub, для того, чтобы не зависеть от платформы и локальной сборки образов и быстро начать работу

Этот раздел охватывает каким образом происходит запуск решения:
1. [Для внутреннего тестироваия на 400 КТ](#1-быстрый-старт-из-заранее-подготовленного-образа-инференса)
2. [Для развертывания сервиса](#2-быстрый-старт-из-заранее-подготовленных-образов-сервисов)

# 1. Быстрый старт внутреннего тестирования на 400 КТ из заранее подготовленного образа

Этот образ содержит в себе все необходимые модели и скрипты для запуска инференса. Внутри образа есть скрипт `inference.py`, который и будет запускать инференс.

Чтобы запустить инференс для папки с архивами, необходимо:

1. Внутри файла `inference.remote.sh` необходимо заменить переменную `YOUR_INPUT_FOLDER_WITH_ZIPS` на абсолютный путь к папке с архивами.

⚠️ Обязательно указывайте АБСОЛЮТНЫЙ путь к исходной папке с архивами.

Таким образом ваш скрипт для развертывания решения будет выглядеть следующим образом:
```bash
#!/bin/bash

# Путь к входным данным в папке (рекомендуется указать АБСОЛЮТНЫЙ путь)
# Папка с zip-файлами должна иметь структуру вида:
# YOUR_INPUT_FOLDER_WITH_ZIPS/
#   study_id_1.zip
#   study_id_2.zip
#   ...
#   final_archive.zip

# НАПРИМЕР: YOUR_INPUT_FOLDER_WITH_ZIPS="/home/borntowarn/projects/chest-diseases/input"

# НАПРИМЕР: YOUR_INPUT_FOLDER_WITH_ZIPS="C:/ВАШ/ПУТЬ/К/ПАПКЕ/С/АРХИВАМИ"

# НАПРИМЕР: YOUR_INPUT_FOLDER_WITH_ZIPS="C:\ВАШ\ПУТЬ\К\ПАПКЕ\С\АРХИВАМИ"

###########################################################################
#                                                                         #
#   Будьте внимательны, необходимо передать путь к ПАПКЕ, а не к файлу!   #
#                                                                         #
###########################################################################

YOUR_INPUT_FOLDER_WITH_ZIPS="/home/borntowarn/projects/chest-diseases/input"
YOUR_OUTPUT_FOLDER="/$PWD/output"

echo "ВАШ ПУТЬ К ПАПКЕ С АРХИВАМИ: $YOUR_INPUT_FOLDER_WITH_ZIPS"
echo "ВАШ ПУТЬ К ПАПКЕ С РЕЗУЛЬТАТАМИ: $YOUR_OUTPUT_FOLDER"

docker run \
    -it \
    --gpus "all" \
    -e INPUT_FOLDER="./input" \
    -v "$YOUR_INPUT_FOLDER_WITH_ZIPS":/training/input \
    -v "$YOUR_OUTPUT_FOLDER":/training/output \
    borntowarn/porcupine-inference
```

-  Папка `INPUT_FOLDER="./input"` - внутренняя папка, в которую будут монтироваться входные данные из папки `YOUR_INPUT_FOLDER_WITH_ZIPS`
-  Папка `YOUR_OUTPUT_FOLDER` - папка, в которую будут сохраняться результаты инференса: файлы `output.xlsx` и `warnings_and_errors.txt`. Она автоматически примонтируется в локальной файловой системе и будет доступна.

2. Запустить скрипт:
```bash
bash ./inference.remote.sh
```

Это запустит скачивание контейнера из Docker Hub и автоматически запустит скрипт `inference.py` внутри него по примонтированной папке, которая указана в `YOUR_INPUT_FOLDER_WITH_ZIPS`.
Он пробежит по всем элементам папки `YOUR_INPUT_FOLDER_WITH_ZIPS`, выполнит для них инференс и сохранит в папку `output` 2 файла:
- `output.xlsx` - результаты инференса в формате Excel
- `warnings_and_errors.txt` - ошибки чтения файлов и предупреждения в формате txt.


# 2. Быстрый старт сервисов из заранее подготовленных образов

Эти образы содержат в себе все необходимые модели и скрипты для запуска сервисов.

Чтобы запустить сервисы для развертывания решения, необходимо:

1. Запустить `start.remote.sh` для запуска сервисов из Docker Hub
```bash
sh ./start.remote.sh
```

Docker автоматически начнет скачивать образы с заранее подготовленными моделями и скриптами внутри, для того, чтобы не тратить время на сборку образов.

ℹ️ При первом запуске загрузка образов может занять значительное время необходимое для загрузки образов. Контейнеры весят в сумме около 20Гб.

2. Чтобы остановить сервисы, необходимо запустить `stop.remote.sh`:
```bash
sh ./stop.remote.sh
```